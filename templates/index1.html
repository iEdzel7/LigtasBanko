<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <link rel="shortcut icon" href="../static/assets/logo.png" type="image/x-icon" />
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    .chat-box {
        left: 1100px;
        top: 230px;
        width: 400px;
        height: 500px;
        border: 1px solid gray;
        border-radius: 35px;
        position: fixed;
        display: flex;
        flex-direction: column;
        overflow: hidden; /* Prevent overflow outside of this box */
        background-color: white;
    }

    .message-container {
        flex-grow: 1; /* Ensures it occupies the remaining height */
        overflow-y: auto; /* Allows scrolling when content overflows */
        max-height: calc(100% - 60px - 40px); /* Adjust for the space occupied by the textarea */
        padding-right: 10px; /* Optional: Prevent scroll bar overlap with the messages */
        box-sizing: border-box; /* Ensure padding doesn't affect height calculation */
        padding-bottom: 60px; /* Ensure space for last message */
        background-color: white;
    }

    .message {
        margin: 10px 0;
        word-wrap: break-word; /* Break long words if necessary */
        overflow-wrap: break-word; /* Ensure text fits in smaller spaces */
        box-sizing: border-box; /* Include padding/border in element size */
    }


    .user {
        color: white;
        font-size: 16px;
        font-weight: 350;
        text-align: center;
        font-family: 'Lexend';
    }

    .assistant {
        color: black;
        font-size: 16px;
        font-weight: 250;
        text-align: center;
        font-family: 'Lexend';
    }

    textarea {
        width: 335px; /* Make textarea take full width of the form container */
        padding: 10px; /* Padding inside textarea */
        border: 1px solid #19D6BD; /* Border with color matching the form container */
        border-radius: 30px; /* Rounded corners for the textarea */
        font-size: 16px; /* Set font size for the text inside textarea */
        font-family: 'Lexend'; /* Same font family for consistency */
        resize: none; /* Disable resizing of textarea */
        text-align: left;
        height: 30px; /* Adjust height of the textarea */
        margin: 10px auto; /* Center the textarea */
        position: absolute; /* Fix position at the bottom of the chat-box */
        bottom: 10px; /* Distance from the bottom edge of the chat-box */
        left: 20px; /* Align with the container */
        background-color: white;
    } 

    .bot-box {
        position: relative;
        top: 10px;
        left: 120px;
        transform: translateX(-50%);
        max-width: 200px;
        width: auto;
        height: auto;
        background-color: #E6E6E6;
        border-radius: 35px;
        padding: 10px;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .user-box {
        position: relative;
        top: 10px;
        left: 270px;
        transform: translateX(-50%);
        max-width: 200px;
        width: auto;
        height: auto;
        background-color: #19D6BD;
        border-radius: 35px;
        padding: 10px;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .message.assistant,
    .message.user {
        margin: 10px 0;
        position: relative;
        width: 100%;
        text-align: justify;
    }

    .message p {
        margin: 0;
        word-wrap: break-word; /* Ensure the text breaks to fit the box */
    }

    .top-design {
        height: 80px;
        background: linear-gradient(to right, #19D6BD, #0BB8E0);
        width: 100%;
        border-top-left-radius: 35px;
        border-top-right-radius: 35px;
        flex-shrink: 0; /* Prevent shrinking */
    }

     /* Styling for the logo */
    #Elvi-Icon {
        position: absolute; /* Absolutely position the logo inside the container */
        top: 38px; /* Vertically center the logo */
        left: 60px; /* Horizontally center the logo */
        transform: translate(-50%, -50%); /* Offset by 50% of the logo's size to center it exactly */
        width: 60px;
        height: 60px;
        filter: drop-shadow(0px 4px 4px rgba(0, 0, 0, 0.25));
    }

    /* Styling for the text below the logo */
    .elvi-text1 {
        position: absolute;
        top: 16px; /* Position the text below the logo */
        left: 146px; /* Horizontally center the text */
        transform: translateX(-50%); /* Offset by 50% of the text's size to center it exactly */
        color: white; /* White color for the text */
        font-size: 17px; /* Font size */
        font-weight: 250; /* Regular weight */
        font-family: 'Lexend';
        text-align: center; /* Center-align the text */
        width: 520px;
    }
    
    /* Styling for the text below the logo */
    .elvi-text2 {
        position: absolute;
        top: 38px; /* Position the text below the logo */
        left: 189px; /* Horizontally center the text */
        transform: translateX(-50%); /* Offset by 50% of the text's size to center it exactly */
        color: white; /* White color for the text */
        font-size: 19px; /* Font size */
        font-weight: 350; /* Regular weight */
        font-family: 'Lexend';
        text-align: center; /* Center-align the text */
        width: 520px;
    }

    /* Styling for the logo */
    #Arrow-white-2 {
        position: absolute; /* Absolutely position the logo inside the container */
        top: 40px; /* Vertically center the logo */
        left: 350px; /* Horizontally center the logo */
        transform: translate(-50%, -50%); /* Offset by 50% of the logo's size to center it exactly */
        width: 50px;
        height: 50px;
        filter: drop-shadow(0px 4px 4px rgba(0, 0, 0, 0.25));
        cursor: pointer;
        z-index: 1004;
    }
    .completion-style {
        margin-top: -30px;
        border: 2px solid #19D6BD;
        padding: 10px;
        border-radius: 30px;
        background: transparent; /* Ensure the inside is transparent */
        display: flex; /* Use flexbox to align items */
        align-items: center; /* Vertically align items in the center */
        position: relative; /* To position the logo inside the div */
    }

    .explanation-logo {
        position: absolute;
        top: 25px; /* Adjust the position of the logo */
        left: 20px; /* Adjust the position of the logo */
        width: 50px;
        height: 50px; /* Adjust if needed */
    }

    .completion-text {
        margin-top: 20px;
        margin-left: 80px; /* Space out the text from the logo */
        margin-right: 30px;
        margin-bottom: 30px;
        font-size: 16px; /* Adjust as needed */
        color: black; /* Ensure text color is visible */
        font-family: 'Lexend'; /* Set desired font-family */
        text-align: justify;
        flex-grow: 3; /* Allow the text to stretch out to fill available space */
        white-space: normal; /* Ensure the text wraps as needed */
        max-width: 100%;
    }


  </style>

  <title>LigtasBanko</title>
  <link rel="stylesheet" href="../static/css/index1.css">
  <link rel="stylesheet" href="../static/css/footer.css">
  <link rel="stylesheet" href="../static/css/style.css">
  <!-- Add Google Fonts for Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
  <nav id="desktop-nav">
    <a href="{{ url_for('index') }}#profile-id">
    <img src="../static/assets/logo.png" alt="Logo" class="logo-lg">
      </a>

    <div class="logo1"></div>
    <div>
        <ul class="nav-links">
            <li><a href="{{ url_for('email_pwn') }}#profile-id">Check</a></li>
            <li><a href="#detect">Detect</a></li>
            <li><a href="{{ url_for('index2') }}#profile-id">Report</a></li>
        </ul>
    </div>
  </nav>

  <section id="detect">
    <p class="section__text__p1">Protect Your Online Security with LigtasBanko's</p>
    <h1 class="title">Phishing Detection</h1>
    <br><br>
    <div class="detect">
      <div class="group-parent">
        <div class="rectangle-parent4" id="rectangle-parent4">
            <div class="rectangle-parent2">
              <div class="group-child9"></div>
              <!-- Add this button inside .rectangle-parent2 -->
              <div class="submit1" id="submitBtn">Submit</div>
            </div>
            <div class="rectangle-parent3">
              <div class="group-child10"></div>
              <!-- Add this button inside .rectangle-parent2 -->
              <div class="submit2" id="clearBtn">Clear</div>
            </div>
        </div>

        <div id="results" class="results"></div>
        <div class="group-parent1">
          <div class="to-submit-a-suspicious-url-and-parent">
            <div class="group-frame">
              <div class="group-parent2">
                <!-- Paste URL -->
                <div id="PasteURL" class="PasteURL-Group">
                  <div class="PasteURL-Box"></div>
                  <div class="PasteURL-BoxOnly"></div>
                  <img class="serviceslogo-1-icon" alt="" src="../static/assets/link.png" />
                  <input type="text" id="urlInput" class="insert-link-here" placeholder="Paste URL" />
                </div>

                <!-- Paste Message -->
                <div id="Message" class="MessageGroup" style="display: none;">
                  <div class="Message-Box-and-Text">
                    <div class="Message-BoxOnly"></div>
                    <img class="msg-1-icon" alt="" src="../static/assets/message.png" />
                    <input type="text" id="msgInput" class="insert-link-here1" placeholder="Paste message" />
                  </div>
                </div>
              
                <!-- Screenshot -->
                <div class="ScreenshotGroup" id="Screenshot" style="display: none; cursor: pointer;">
                  <div class="Screenshot-box" id="uploadLabel">
                    <!-- Input element for uploading a screenshot -->
                    <input type="file" accept="image/jpeg, image/jpg, image/png" name="screenshotUpload" id="screenshotUpload" style="position: absolute; left: -9999px; opacity: 0; ">
                    <label for="screenshotUpload" style="cursor: pointer;">
                      <img class="icon6" alt="" src="../static/assets/ss.png" />
                      <div class="filename-placeholder">Upload Screenshot (jpeg/jpg/png)</div>
                    </label>
                  </div>
                </div>





                

                

              </div>
            </div>
          </div>
          <div class="choose-how-you-want-to-submit-parent">
            <div class="choose-how-you">
              Choose how you want to submit the suspicious content:
            </div>
            <div class="rectangle-parent6">
              <div class="group-child13" id="submissionContainer">
                <img class="PhishingMethod-icon" alt="" src="../static/assets/Checkmark2.png" />
                <div id="submissionButton" class="button-rectangle">Select Submission Method</div>
                <!-- Dropdown Content -->
                <div class="options-containerPhishingDetector" style="display: none;">
                  <label class="option-labelPhishingDetector">URL</label>
                  <label class="option-labelPhishingDetector">Text Message</label>
                  <label class="option-labelPhishingDetector">Screenshot</label>
                </div>
              </div>
            </div>
            <div class="attach-the-content">
              Attach the content in the provided field:
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Chatbot Icon that opens the container -->
  <img src="../static/assets/LigtasBanko-Chatbot-Icon.png" alt="Chatbot Icon" id="chatbotIcon" />

  <!-- Chatbot container that will be toggled -->
  <div class="chatbot-container" id="chatbot-Container" style="display: none;">
    <!-- Set the image with the correct path -->
    <img src="../static/assets/Chatbot-Background.png" alt="Chatbot Background" id="chatbotBackground">

    <!-- Place the logo inside the chatbot background -->
    <div class="logo-white">
      <img src="../static/assets/logo-white.png" alt="LigtasBankoLogo" id="LoGo">
    </div>

    <!-- Place the arrow inside the chatbot background -->
    <div class="arrow">
      <img src="../static/assets/arrow.png" alt="LigtasBankoArrow" id="Arrow-white">
    </div>

    <!-- Add the text below the logo -->
    <div class="logo-text">
      Let Elvi work for you
    </div>

    <!-- White square inside the chatbot container -->
    <div class="white-square"></div>
    
    <div class="start-now" id="start-now">
      Start now
    </div>
  </div>

  <div class="chat-box" id="chat-box" style="display: none;">
    <div class="top-design">
        <div class="Arrow-white">
            <img src="../static/assets/Elvi-Icon.png" alt="LigtasBankoElvi-Icon" id="Elvi-Icon">
          </div>

          <!-- Add the text below the logo -->
        <div class="elvi-text1">
            Chat with
        </div>
    
        <!-- Add the text below the logo -->
        <div class="elvi-text2">
            LigtasBanko's Elvi
        </div>

        <!-- Place the elvi icon inside the chatbot background -->
        <div class="Arrow-white-2">
            <img src="../static/assets/arrow.png" alt="LigtasBankoElvi-Icon" id="Arrow-white-2">
        </div>

    </div>
    <div class="message-container" id="message-container">
      {% for message in session['messages'] %}
          {% if message.content != 'test' %}
              <div class="message {{ message.role }}">
                  <strong>{{ 'User' if message.role == 'user' else 'Assistant' }}:</strong>
                  <p>{{ message.content }}</p>
              </div>
          {% endif %}
      {% endfor %}
   </div>
   

    <div class="textarea-container">
        <textarea id="user-message" rows="4" cols="50" placeholder="Enter your message..." onkeydown="checkEnter(event)"></textarea>
    </div>
</div>

  <footer>
    <div class="ligtasbanko2">
      <div class="ligtasbanko3">ligtasbanko</div>
      <div class="home-services-info-wrapper">
        <div class="home-services-info-container">
          <p class="home"><a href="{{ url_for('index') }}#profile-id">Home</a></p>
          <p class="home"><a href="index.html#services">Services</a></p>
          <p class="home"><a href="index.html#info">Info</a></p>
        </div>
      </div>
      <div class="tools-report-contact-us-wrapper">
        <div class="tools-report-contact-container">
          <p class="home"><a href="index.html#tools">Tools</a></p>
          <p class="home"><a href="index.html#contact">Contact Us</a></p>
        </div>
      </div>
      <div class="terms-and-conditions-container">
        <p class="home" onclick="window.open('LigtasBanko-TermsandConditions.pdf')">Terms and Conditions</p>
        <p class="home" onclick="window.open('LigtasBanko-PrivacyPolicy.pdf')">Privacy Policy</p>
        <p class="home" onclick="window.open('LigtasBanko-CookiePolicy.pdf')">Cookie Policy</p>
      </div>
      <div class="copyright-2024">
        Copyright © 2024 LigtasBanko. All Rights Reserved.
      </div>
      <div class="icons8-facebook-50-2-parent">
        <img class="icons8-facebook-50-2" alt="" src="../static/assets/fb.png" onclick="window.open('https://www.facebook.com/christinetorres.marasigan')" />
        <div class="follow-us">Follow us</div>
        <img class="icons8-instagram-50-1-2" alt="" src="../static/assets/ig.png" onclick="window.open('https://www.instagram.com/iedzel/')" />
        <img class="linkedin-1-icon" alt="" src="../static/assets/linkedin.png"  />
        <img class="github-1-icon" alt="" src="../static/assets/github.png" onclick="window.open('https://github.com/Malceid')" />
      </div>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='scripts/main.js') }}"></script>
  <script>
    document.getElementById('submitBtn').addEventListener('click', () => {
      const urlInput = document.getElementById('urlInput').value;
      const msgInput = document.getElementById('msgInput').value;
      const ssInput = document.getElementById('screenshotUpload').files[0]; // Accessing the first selected file
    
      // Determine which input to use
      const userInput = urlInput || msgInput || ssInput;
      if (!userInput) {
        alert('Please enter a URL or message.');
        return;
      }
    
      // Send user input to the server
      const formData = new FormData();
      formData.append('user_input', userInput);
    
      // Append the file input field to the form data if a file is selected
      if (ssInput) {
        formData.append('screenshotUpload', ssInput);
      }
    
      fetch('/analyze_url', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ user_input: userInput })
      })
      .then(response => response.json())
      .then(data => {
        console.log("Response data:", data);  // Debugging log to inspect the response
        
        const resultsContainer = document.getElementById('results');
        resultsContainer.innerHTML = ''; // Clear previous results
    
        // Iterate over the results and check for 'UNREACHABLE'
        data.forEach((result, index) => {
          const resultDiv = document.createElement('div');
          resultDiv.classList.add('result-item'); // Add a class to the container div
    
          let confidenceColor, imageSrc, imageClass;
    
          // Check for prediction and set appropriate values
          if (result.prediction === "PHISHING") {
              confidenceColor = 'red';
              imageSrc = '../static/assets/phish.png';
              imageClass = 'PhishingImage';
              // No need for inline styles here
          } else if (result.prediction === "BENIGN") {
              confidenceColor = 'green';
              imageSrc = '../static/assets/SAFE1.png';
              imageClass = 'BenignImage';
              // No need for inline styles here
          } else if (result.prediction === "UNREACHABLE") {
              console.log('UNREACHABLE detected');
              confidenceColor = 'gray'; // Set gray for unreachable
              imageSrc = '../static/assets/Unreachable.png'; // No image for unreachable
              imageClass = 'UnreachableImage';
          } else {
              console.log('Unknown prediction:', result.prediction);
          }

          // Ensure result.explanation is an array, else provide a default message
          const explanationList = Array.isArray(result.explanation) ? 
              result.explanation.map(explanation => `<li>${explanation}</li>`).join('') :
              `<li>No explanation available</li>`; // Default message for non-array explanations

          resultDiv.innerHTML = `
              <div class="result-content">
                  <p class="url"><strong>URL:</strong> ${result.url}</p>
                  <div class="ResultAndConfidence" id="ResultAndConfidence">
                      <p class="prediction" style="color: ${confidenceColor};"> ${result.prediction}</p>
                      <p class="confidence" style="color: ${confidenceColor};"> ${result.confidence}</p>
                  </div>
                  ${imageSrc ? `<img src="${imageSrc}" alt="Image" class="${imageClass}">` : ''} <!-- Only display image if there's one -->
                  <ul class="explanation-list">
                      <li class="important-features"><strong>Most important features:</strong></li>
                      ${explanationList}
                  </ul>

                  <div class="completion-style">
                      <img src="../static/assets/explanation-logo.png" alt="Image" class="explanation-logo">
                      <div class="completion-text">
                          <strong></strong> ${result.chat_completion}
                      </div>
                  </div>
              </div>
          `;

          resultsContainer.appendChild(resultDiv);

        });
    
        // After appending results, adjust the position of ResultAndConfidence
        const selectedValue = document.getElementById("submissionButton").textContent;
        if (selectedValue === "Text Message") {
          const ResultConfidence = document.getElementById('ResultAndConfidence');
          if (ResultConfidence) {
            ResultConfidence.style.top = "70px";
          }
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
    });

  

  // Check if Enter key is pressed
  function checkEnter(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();  // Prevent new line insertion
                sendMessage();
            }
        }

        // Send message to server and get response
        function sendMessage() {
            const userMessage = document.getElementById('user-message').value;
            const maxTokens = 8192;  // Fixed token limit for the selected model

            // Append user message inside the user-box
            const messageContainer = document.getElementById('message-container');
            const userDiv = document.createElement('div');
            userDiv.classList.add('message', 'user');

            // Create user-box to enclose the user's message
            const userBox = document.createElement('div');
            userBox.classList.add('user-box');
            userBox.innerHTML = `<p>${userMessage}</p>`;

            // Append user box to the user's message
            userDiv.appendChild(userBox);
            messageContainer.appendChild(userDiv);

            // Clear the message box
            document.getElementById('user-message').value = '';

            // Send to server
            fetch('/send_message', {
                method: 'POST',
                body: new URLSearchParams({
                    'message': userMessage,
                    'max_tokens': maxTokens
                }),
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            })
            .then(response => response.json())
            .then(data => {
                // Append assistant's response inside a white square (bot-box)
                const assistantDiv = document.createElement('div');
                assistantDiv.classList.add('message', 'assistant');
                
                // Create bot-box to enclose the assistant's response
                const botBox = document.createElement('div');
                botBox.classList.add('bot-box');
                botBox.innerHTML = `<p>${data.response}</p>`;

                // Append bot box to the assistant's message
                assistantDiv.appendChild(botBox);
                messageContainer.appendChild(assistantDiv);

                // Scroll to the bottom to show the latest message
                const chatBox = document.getElementById('chat-box');
                messageContainer.scrollTop = messageContainer.scrollHeight;

            });
        }

      const chatbotIcon = document.getElementById('chatbotIcon');
      const chatbotContainer = document.getElementById('chatbot-Container');
      const arrow = document.getElementById('Arrow-white');
      const startNow = document.getElementById('start-now');
      const chatbotContainer2 = document.getElementById('chat-box');
      const arrow2 = document.getElementById('Arrow-white-2');
    
      chatbotIcon.addEventListener('click', () => {
        console.log('Chatbot icon clicked');
        chatbotIcon.style.display = 'none'; // Hide the icon
        chatbotContainer2.style.display = 'none'; // Hide the container2
        chatbotContainer.style.display = 'block'; // Show the container
      });
    
      arrow.addEventListener('click', () => {
        console.log('Arrow clicked');
        chatbotContainer.style.display = 'none'; // Hide the container
        chatbotContainer2.style.display = 'none'; // Hide the container-2
        chatbotIcon.style.display = 'block'; // Show the icon
      });

      startNow.addEventListener('click', () => {
        console.log('Start Now clicked');
        chatbotContainer.style.display = 'none'; // Hide the container
        chatbotIcon.style.display = 'none'; // Hide the icon
        chatbotContainer2.style.display = 'block'; // Show the chatbotcontainer-2
      });

      arrow2.addEventListener('click', () => {
        console.log('Arrow2 clicked');
        chatbotContainer.style.display = 'none'; // Hide the container
        chatbotContainer2.style.display = 'none'; // Hide the container-2
        chatbotIcon.style.display = 'block'; // Show the icon
      });
    </script>
    

  
</body>
</html>